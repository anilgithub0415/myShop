"use strict";(self.webpackChunkEshop=self.webpackChunkEshop||[]).push([[675],{1675:(de,v,t)=>{t.r(v),t.d(v,{SellerModule:()=>te});var p=t(6895),c=t(7716),Z=t(5567),g=t(655),e=t(4650),a=t(4006),R=t(4350),h=t(7807),b=t(7596),P=t(6173),T=t(2011),f=t(2114),U=t(9165),O=t(4704);function S(r,s){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&r){var o=e.oxw();e.xp6(1),e.Oqu(o.mobileNumber)}}function A(r,s){1&r&&(e.TgZ(0,"span",14),e._uU(1," userid not provided. "),e.qZA())}function N(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"userid is required."),e.qZA())}function I(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"userid must be a 10-digit number."),e.qZA())}function J(r,s){if(1&r&&(e.TgZ(0,"div",15),e.YNc(1,N,2,0,"div",0),e.YNc(2,I,2,0,"div",0),e.qZA()),2&r){var o=e.oxw();e.xp6(1),e.Q6J("ngIf",null==o.f.userid||null==o.f.userid.errors?null:o.f.userid.errors.required),e.xp6(1),e.Q6J("ngIf",null==o.f.userid||null==o.f.userid.errors?null:o.f.userid.errors.pattern)}}function Y(r,s){1&r&&(e.TgZ(0,"span",14),e._uU(1," display_name not provided. "),e.qZA())}function M(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"display_name is required."),e.qZA())}function x(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"display_name must be at least 4 character length."),e.qZA())}function F(r,s){if(1&r&&(e.TgZ(0,"div",15),e.YNc(1,M,2,0,"div",0),e.YNc(2,x,2,0,"div",0),e.qZA()),2&r){var o=e.oxw();e.xp6(1),e.Q6J("ngIf",null==o.f.display_name||null==o.f.display_name.errors?null:o.f.display_name.errors.required),e.xp6(1),e.Q6J("ngIf",null==o.f.display_name||null==o.f.display_name.errors?null:o.f.display_name.errors.minlength)}}function q(r,s){1&r&&(e.TgZ(0,"span",14),e._uU(1," consumer_address not provided. "),e.qZA())}function Q(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"consumer_address is required."),e.qZA())}function E(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"consumer_address must be at least 20 character length."),e.qZA())}function j(r,s){if(1&r&&(e.TgZ(0,"div",15),e.YNc(1,Q,2,0,"div",0),e.YNc(2,E,2,0,"div",0),e.qZA()),2&r){var o=e.oxw();e.xp6(1),e.Q6J("ngIf",null==o.f.consumer_address||null==o.f.consumer_address.errors?null:o.f.consumer_address.errors.required),e.xp6(1),e.Q6J("ngIf",null==o.f.consumer_address||null==o.f.consumer_address.errors?null:o.f.consumer_address.errors.minlength)}}function G(r,s){1&r&&(e.TgZ(0,"div"),e._uU(1,"This number already registered"),e.qZA())}var z=function(){function r(s,o,n,i,l,u,m,d,ie,ae,ue,le){this.formBuilder=s,this.servProduct=o,this.servUser=n,this.servUserExtra=i,this.servSellercommission=l,this.servCategory=u,this.authServ=m,this.otpService=d,this.notify=ie,this.router=ae,this.route=ue,this.servAuth=le,this.alExists=!1,this.selectedSeller_id=null,this.formSaved=new e.vpe,this.addedit_OPmode="Add",this.isSubmitted=!1,this.isSubmitted_uploadform=!1,this.passwordsMatchValidator=function(y){var C=y.get("password"),_=y.get("passwordRepeat");return C&&_&&C.value!==_.value?{passwordsMatch:!0}:null}}return r.prototype.ngOnInit=function(){var s;return(0,g.mG)(this,void 0,void 0,function(){var o,n=this;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return alert("sellerid:"+(null===(s=this.servAuth.currentUserValue)||void 0===s?void 0:s.id)),this.param_Customer_id=0,this.myForm=this.formBuilder.group({id:[""],userid:["",[a.kI.required,a.kI.pattern("^[0-9]{10}$")]],display_name:["",[a.kI.required,a.kI.minLength(4),a.kI.maxLength(50)]],consumer_address:["",[a.kI.required,a.kI.minLength(20),a.kI.maxLength(200)]]},{validators:this.passwordsMatchValidator}),this.route.params.subscribe(function(l){return n.mobileNumber=l.mobilenumber}),this.myForm.patchValue({userid:this.mobileNumber}),[4,this.alreadyExist_Consumer(this.mobileNumber,1,"pending",this.servAuth.currentUserValue.id)];case 1:return o=i.sent(),alert("alExists:"+o),o&&this.myForm.patchValue({display_name:this.ExtraObj.display_name,consumer_address:this.ExtraObj.consumer_address}),[2]}})})},r.prototype.alreadyExist_Consumer=function(s,o,n,i){var l=this;return void 0===o&&(o=0),void 0===n&&(n=""),void 0===i&&(i=0),new Promise(function(u,m){l.servUserExtra.getConsumers(s,o,n,i).subscribe(function(d){console.log("getConsumer response for approve:"+JSON.stringify(d)),d[0]&&d[0].userid?(l.ExtraObj=d[0],u(!0)):u(!1)})})},r.prototype.preserved_alreadyExist_Consumer=function(s,o){var n=this;return new Promise(function(i,l){n.servUserExtra.getConsumers(s,o).subscribe(function(u){console.log("getConsumer response:"+JSON.stringify(u)),i(!(!u[0]||!u[0].userid))})})},Object.defineProperty(r.prototype,"errorControl",{get:function(){return this.myForm.controls},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"f",{get:function(){return this.myForm.controls},enumerable:!1,configurable:!0}),r.prototype.Register_Consumer_Request_ApproveReject=function(){var s,o={mobileNumber:this.errorControl.userid.value,seller_id:null===(s=this.servAuth.currentUserValue)||void 0===s?void 0:s.id,approval_status:"approved",action:"register_request_approve"};this.servUserExtra.SendRegistrationRequest(o).subscribe()},r.prototype.Register_NewCustomernotinuse=function(){this.otpService.sendotpORregister({mobileNumber:this.errorControl.userid.value,display_name:this.errorControl.display_name.value,consumer_address:this.errorControl.consumer_address.value,password:this.errorControl.password.value,action:"register_request"},"register_request").subscribe(function(s){console.log("response of registring user:"+s)},function(s){console.error("Failed to register customer"),console.error(s)})},r.prototype.passwordValidator=function(s){var o=s.value;return o?/[A-Z]/.test(o)?/\d/.test(o)?o.length<5?{minlength:!0}:null:{digit:!0}:{uppercase:!0}:null},r.prototype.onSubmit=function(){this.myForm.valid?(alert("readyfor sending register_request"),this.Register_Consumer_Request_ApproveReject(),alert("Request sent for approval to supplier,ur request will be approved, pls ask ur supplier to approve ur request")):alert("invalid form")},r.prototype.onSelectProduct=function(s){console.log("in onSelectProduct"),this.selectedSeller_id=s.id},r.\u0275fac=function(o){return new(o||r)(e.Y36(a.qu),e.Y36(R.M),e.Y36(h.K),e.Y36(b.P),e.Y36(P.b),e.Y36(T.H),e.Y36(f.$),e.Y36(U.n),e.Y36(O.g),e.Y36(c.F0),e.Y36(c.gz),e.Y36(f.$))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-registerapproveconsumer"]],inputs:{param_Customer_id:"param_Customer_id"},outputs:{formSaved:"formSaved"},decls:33,vars:10,consts:[[4,"ngIf"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-4"],[1,"form-group"],["for","userid"],["readonly","","type","text","formControlName","userid","id","userid",1,"form-control"],["class","error",4,"ngIf"],["class","text-danger",4,"ngIf"],["for","display_name"],["type","text","formControlName","display_name","id","display_name",1,"form-control"],["for","consumer_address"],["type","text","formControlName","consumer_address","id","consumer_address",1,"form-control"],["type","submit",1,"btn","btn-primary"],[1,"error"],[1,"text-danger"]],template:function(o,n){1&o&&(e.TgZ(0,"p"),e._uU(1,"registerapproveconsumer works!"),e.qZA(),e.TgZ(2,"p"),e._uU(3,"New Customer Online Approving Registration"),e.qZA(),e._uU(4,"\nmobilenumber:"),e.YNc(5,S,2,1,"span",0),e.TgZ(6,"form",1),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.TgZ(7,"div",2)(8,"div",3)(9,"div",4)(10,"label",5),e._uU(11,"Mobile Number"),e.qZA(),e._UZ(12,"input",6),e.YNc(13,A,2,0,"span",7),e.YNc(14,J,3,2,"div",8),e.qZA()(),e.TgZ(15,"div",3)(16,"div",4)(17,"label",9),e._uU(18,"Customer Name"),e.qZA(),e._UZ(19,"input",10),e.YNc(20,Y,2,0,"span",7),e.YNc(21,F,3,2,"div",8),e.qZA()(),e.TgZ(22,"div",3)(23,"div",4)(24,"label",11),e._uU(25,"consumer_address"),e.qZA(),e._UZ(26,"input",12),e.YNc(27,q,2,0,"span",7),e.YNc(28,j,3,2,"div",8),e.qZA()()(),e.YNc(29,G,2,0,"div",0),e._uU(30),e.TgZ(31,"button",13),e._uU(32,"Approve"),e.qZA()()),2&o&&(e.xp6(5),e.Q6J("ngIf",n.mobileNumber),e.xp6(1),e.Q6J("formGroup",n.myForm),e.xp6(7),e.Q6J("ngIf",n.isSubmitted&&(null==n.errorControl.userid.errors?null:n.errorControl.userid.errors.required)),e.xp6(1),e.Q6J("ngIf",(null==n.f.userid?null:n.f.userid.invalid)&&((null==n.f.userid?null:n.f.userid.dirty)||(null==n.f.userid?null:n.f.userid.touched))),e.xp6(6),e.Q6J("ngIf",n.isSubmitted&&(null==n.errorControl.display_name.errors?null:n.errorControl.display_name.errors.required)),e.xp6(1),e.Q6J("ngIf",(null==n.f.display_name?null:n.f.display_name.invalid)&&((null==n.f.display_name?null:n.f.display_name.dirty)||(null==n.f.display_name?null:n.f.display_name.touched))),e.xp6(6),e.Q6J("ngIf",n.isSubmitted&&(null==n.errorControl.consumer_address.errors?null:n.errorControl.consumer_address.errors.required)),e.xp6(1),e.Q6J("ngIf",(null==n.f.consumer_address?null:n.f.consumer_address.invalid)&&((null==n.f.consumer_address?null:n.f.consumer_address.dirty)||(null==n.f.consumer_address?null:n.f.consumer_address.touched))),e.xp6(1),e.Q6J("ngIf",n.alExists),e.xp6(1),e.hij(" myForm.valid:",n.myForm.valid," "))},dependencies:[p.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u]}),r}(),B=t(4766),V=t(529),K=t(6395),$=t(5474),H=t(6493),L=t(868);function X(r,s){if(1&r){var o=e.EpF();e.TgZ(0,"div")(1,"button",9),e.NdJ("click",function(){e.CHM(o);var l=e.oxw();return e.KtG(l.createOrder())}),e._uU(2,"Pay Commission"),e.qZA(),e._UZ(3,"input",10),e.qZA()}if(2&r){var n=e.oxw();e.xp6(3),e.Q6J("ngModel",n.Commision_to_pay)}}function D(r,s){if(1&r){var o=e.EpF();e.TgZ(0,"div")(1,"razorpay",11),e.NdJ("paymentSuccess",function(l){e.CHM(o);var u=e.oxw();return e.KtG(u.handlePaymentSuccess(l))}),e.qZA()()}if(2&r){var n=e.oxw();e.xp6(1),e.Q6J("param_RP_Orderid",n.RPOrderid)("param_RP_Amount",n.RPamount)("param_RP_currency",n.RPcurrency)("param_RP_receipt",n.RPreceipt)("param_RP_Notes",n.RPnotes)}}function W(r,s){if(1&r){var o=e.EpF();e.TgZ(0,"tr",12)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td",12),e._uU(4),e.qZA(),e.TgZ(5,"td",12),e._uU(6),e.qZA(),e.TgZ(7,"td",12),e._uU(8),e.qZA(),e.TgZ(9,"td",13)(10,"input",14),e.NdJ("ngModelChange",function(u){var m=e.CHM(o);return e.KtG(m.$implicit.selected=u)})("change",function(){e.CHM(o);var u=e.oxw();return e.KtG(u.calculateCommission())}),e.qZA()()()}if(2&r){var n=s.$implicit,i=e.oxw();e.xp6(2),e.Oqu(n.orderId),e.xp6(2),e.Oqu(i.servCommon.GetDisplayNameByKey(i.users,"id",n.userId,"display_name")),e.xp6(2),e.hij(" ",n.EffectiveAmount," "),e.xp6(2),e.hij(" ",n.commission_applicable," "),e.xp6(2),e.Q6J("ngModel",n.selected)}}var w=function(){function r(s,o,n,i,l,u){var m=this;this.http=s,this.winRef=o,this.servOrderCommission=n,this.servAuth=i,this.servUser=l,this.servCommon=u,this.apiUrl=B.N.apiUrl,this.servAuth.currentUser.subscribe(function(d){return m.currentUser=d})}return r.prototype.ngOnInit=function(){var s=this;this.get_Users(),this.Get_Completed_Orders_Of_Sellers_For_PayCommission(),this.servOrderCommission.getSellerpaycommission().subscribe(function(o){return s.Sellerpaycommission=o}),setTimeout(function(){console.log("Sellerpaycommission:"+JSON.stringify(s.Sellerpaycommission)),s.Commision_to_pay=Math.ceil(s.Sellerpaycommission)},3e3)},r.prototype.calculateCommission=function(){var s=this.Unpaid_Commission_Orders_Of_Sellers.filter(function(o){return o.selected});this.Commision_to_pay=s.reduce(function(o,n){return o+n.commission_applicable},0),this.Commision_to_pay=Math.ceil(this.Commision_to_pay)},r.prototype.handlePaymentSuccess=function(s){console.log("m in payCommision of seller and Payment successful:",s);var n=this.Unpaid_Commission_Orders_Of_Sellers.filter(function(i){return i.selected}).map(function(i){return i.orderId}).join(",");console.log("comma seperated orderIds are:"+n),this.servOrderCommission.PayCommission_for_Orders(n).subscribe(function(i){console.log("orderIds:"+n+" being declared as PAID status for commission")})},r.prototype.createOrder=function(){var s=this,o=this.apiUrl+"Razor",n={amount:this.Commision_to_pay,currency:"INR",receipt:"RPreceipt",notes:"RPnotes"};console.log("creating order with options:"+JSON.stringify(n)),this.http.post(o,n).subscribe(function(i){console.log("rrrrrrrrrrrrresponse:"+JSON.stringify(i.id)),s.RPOrderid=i.id,s.RPamount=s.Commision_to_pay,s.RPcurrency="INR",s.RPreceipt="RPreceipt",s.RPnotes="RPnotes"})},r.prototype.Get_Completed_Orders_Of_Sellers_For_PayCommission=function(){var s=this;this.servOrderCommission.Get_Completed_Orders_Of_Sellers_For_PayCommission(this.currentUser.id,"Complete").subscribe(function(o){s.Unpaid_Commission_Orders_Of_Sellers=o,console.log("Unpaid_Commission_Orders_Of_Sellers:"+JSON.stringify(s.Unpaid_Commission_Orders_Of_Sellers)),s.Unpaid_Commission_Orders_Of_Sellers.forEach(function(n){n.selected=!0}),s.calculateCommission()})},r.prototype.get_Users=function(){var s=this;this.servUser.getUsers("").subscribe(function(o){s.users=o})},r.\u0275fac=function(o){return new(o||r)(e.Y36(V.eN),e.Y36(K.f),e.Y36($.E),e.Y36(f.$),e.Y36(h.K),e.Y36(H.v))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-paycommission"]],inputs:{events:"events"},decls:20,vars:3,consts:[[1,"row"],[1,"col-6>"],[4,"ngIf"],[1,"col-12"],[1,"card"],[1,"card-body"],[1,"table","table-striped"],[1,"text-primary"],["style","height: 5px;",4,"ngFor","ngForOf"],[1,"btn","btn-danger","btn-sm",3,"click"],["type","text","readonly","",3,"ngModel"],[3,"param_RP_Orderid","param_RP_Amount","param_RP_currency","param_RP_receipt","param_RP_Notes","paymentSuccess"],[2,"height","5px"],[2,"display","none","height","5px"],["type","checkbox",3,"ngModel","ngModelChange","change"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,X,4,1,"div",2),e.YNc(3,D,2,5,"div",2),e.qZA()(),e.TgZ(4,"div",0)(5,"div",3)(6,"div",4)(7,"div",5)(8,"table",6)(9,"thead",7)(10,"th"),e._uU(11,"OrderId"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Customer"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Amount"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Commission"),e.qZA()(),e.TgZ(18,"tbody"),e.YNc(19,W,11,5,"tr",8),e.qZA()()()()()()),2&o&&(e.xp6(2),e.Q6J("ngIf",!n.RPOrderid),e.xp6(1),e.Q6J("ngIf",n.RPOrderid),e.xp6(16),e.Q6J("ngForOf",n.Unpaid_Commission_Orders_Of_Sellers))},dependencies:[L.v,p.sg,p.O5,a.Fj,a.Wl,a.JJ,a.On]}),r}(),ee=[{path:"aa",component:t(7557).N},{path:"",loadChildren:function(){return t.e(317).then(t.bind(t,317)).then(function(r){return r.ManageProductsModule})}},{path:"manage_product",loadChildren:function(){return t.e(317).then(t.bind(t,317)).then(function(r){return r.ManageProductsModule})}},{path:"manage_orders",loadChildren:function(){return Promise.all([t.e(592),t.e(509)]).then(t.bind(t,4509)).then(function(r){return r.ManageOrdersModule})}},{path:"manage_promotions",loadChildren:function(){return Promise.all([t.e(592),t.e(10)]).then(t.bind(t,9010)).then(function(r){return r.ManagePromotionsModule})}},{path:"paycommission",component:w},{path:"dboy",component:Z.l},{path:"registerapproveconsumer/:mobilenumber",component:z},{path:"users",loadChildren:function(){return t.e(480).then(t.bind(t,5480)).then(function(r){return r.ManageUsersModule})}}],re=function(){function r(){}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[c.Bz.forChild(ee),c.Bz]}),r}(),oe=t(3738),ne=t(460),se=t(1633),te=function(){function r(){}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[se.m,p.ez,a.u5,a.UX,oe.W,ne.kn.forRoot(),re]}),r}()}}]);